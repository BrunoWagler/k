#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define maximonotas 8

typedef struct x
{
    char estudantes[100];
    float notas[maximonotas];
    float mediatodos;
    char situacao[15];
} Aluno;

void calcular_media_situacao(Aluno* alunos, int quantidadealunos) 
{
    int i, quantidadeaprovados = 0, quantidaderec = 0, quantidaderepro = 0;
    float soma_notas = 0.0;

    for (i = 0; i < quantidadealunos; i++) 
	{
        float soma = 0.0;
        int j;
        for (j = 0; j < maximonotas; j++) 
		{
            soma += alunos[i].notas[j];
        }
        alunos[i].mediatodos = soma / maximonotas;

        if (alunos[i].mediatodos >= 6.0) 
		{
            strcpy(alunos[i].situacao, "APROVADO");
            quantidadeaprovados++;
        } else if (alunos[i].mediatodos >= 4.0) 
		{
            strcpy(alunos[i].situacao, "RECUPERACAO");
            quantidaderec++;
        } else 
		{
            strcpy(alunos[i].situacao, "REPROVADO");
            quantidaderepro++;
        }

        soma_notas += alunos[i].mediatodos;
    }

    float media_geral = soma_notas / quantidadealunos;

    printf("Quantidade de alunos aprovados: %d\n", quantidadeaprovados);
    printf("Em recuperacao: %d\n", quantidaderec);
    printf("Reprovados: %d\n", quantidaderepro);
    printf("Media geral da turma: %.2f\n\n", media_geral);
}

void imprimir_relatorio(Aluno* alunos, int quantidadealunos, const char* registro) 
{
    FILE* relatorio = fopen(registro, "w");
    if (relatorio == NULL) 
	{
        printf("Erro ao criar o arquivo de relatorio.\n");
        return;
    }

    fprintf(relatorio, "Relatorio de notas\n\n");

    int i;
    for (i = 0; i < quantidadealunos; i++) 
    {
        fprintf(relatorio, "Aluno: %s\n", alunos[i].estudantes);
        fprintf(relatorio, "Media aluno: %.2f\n", alunos[i].mediatodos);
        fprintf(relatorio, "Situacao do aluno: %s\n\n", alunos[i].situacao);
    }

    fclose(relatorio);

    printf("Relatorio salvo em %s\n", registro);
}

int main(int argc, char const *argv[]) 
{
    if (argc != 1) 
	{
        printf("Uso: %s nome_arquivo\n", argv[0]);
        return 1;
    }

    const char* registro = argv[1];

	int quantidadealunos;
	printf("Digite a quantidade de alunos: ");
	scanf("%d", &quantidadealunos);
	Aluno* alunos = (Aluno*) malloc(quantidadealunos * sizeof(Aluno));
if (alunos == NULL) 
{
    printf("Erro ao alocar memoria para os alunos.\n");
    return 1;
}

int i, j;
for (i = 0; i < quantidadealunos; i++) 
{
    printf("\nDigite o nome do aluno %d: ", i+1);
    scanf(" %[^\n]", alunos[i].estudantes);

    for (j = 0; j < maximonotas; j++) 
    {
        printf("Digite a nota %d: ", j+1);
        scanf("%f", &alunos[i].notas[j]);
    }
}

calcular_media_situacao(alunos, quantidadealunos);
imprimir_relatorio(alunos, quantidadealunos, registro);

free(alunos);
return 0;
}
